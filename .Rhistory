~ psu + idno
} else{
~ idno
}
svydesign(
id = sta,
strata = str,
weights = 1 / sddf_data$prob,
data = sddf_data
)
}
})
country <- "Albania"
source("download_sddf.R")
ess6_svydesign <-
sapply(svyinfo, function(x) {
country <- as.character(x$country)
#skip Austria
if (country %in% c("Austria","Albania")) {
return(NULL)
} else{
print(country)
source("download_sddf.R")
str <-
if (x$stratex1 == "yes") {
~ stratify
} else{
~ 1
}
sta <-
if (x$stages > 1) {
~ psu + idno
} else{
~ idno
}
svydesign(
id = sta,
strata = str,
weights = 1 / sddf_data$prob,
data = sddf_data
)
}
})
for(i in 1:length(svyinfo)){
x <- svyinfo[[i]]
country <- as.character(x$country)
#skip Austria
if (country %in% c("Austria","Albania")) {
return(NULL)
} else{
print(country)
source("download_sddf.R")
str <-
if (x$stratex1 == "yes") {
~ stratify
} else{
~ 1
}
sta <-
if (x$stages > 1) {
~ psu + idno
} else{
~ idno
}
svydesign(
id = sta,
strata = str,
weights = 1 / sddf_data$prob,
data = sddf_data
)
}
}
for(i in 1:length(svyinfo)){
x <- svyinfo[[i]]
country <- as.character(x$country)
#skip Austria
if (country %in% c("Austria","Albania")) {
next
} else{
print(country)
source("download_sddf.R")
str <-
if (x$stratex1 == "yes") {
~ stratify
} else{
~ 1
}
sta <-
if (x$stages > 1) {
~ psu + idno
} else{
~ idno
}
svydesign(
id = sta,
strata = str,
weights = 1 / sddf_data$prob,
data = sddf_data
)
}
}
str
svydesign(
id = sta,
strata = str,
weights = 1 / sddf_data$prob,
data = sddf_data
)
sddf_data
"stratify"%in%names(x)
x$stratex1 == "yes"
sta
str
sddf_data$prob
sddf_data
svydesign(
id = sta,
strata = str,
weights = 1 / sddf_data$prob,
data = sddf_data
)
for(i in 1:length(svyinfo)){
x <- svyinfo[[i]]
country <- as.character(x$country)
#skip Austria
if (country %in% c("Austria","Albania")) {
next
} else{
print(country)
source("download_sddf.R")
str <-
if (x$stratex1 == "yes") {
~ stratify
} else{
NULL
}
sta <-
if (x$stages > 1) {
~ psu + idno
} else{
~ idno
}
svydesign(
id = sta,
strata = str,
weights = 1 / sddf_data$prob,
data = sddf_data
)
}
}
sddf_data
str
sta
svydesign(
id = sta,
strata = str,
weights = 1 / sddf_data$prob,
data = sddf_data
)
sta
sddf_data$idno
is.na(sddf_data$idno)
any(is.na(sddf_data$idno))
which(is.na(sddf_data$idno))
sddf_data$idno
sddf_data$idno
sddf_data[which(is.na(sddf_data$idno)),]
sddf_data[which(is.na(sddf_data$idno)),]
tail(sddf_data[which(is.na(sddf_data$idno)),])
sddf_data
country
sddf_data %<>%
filter(!is.na(indo))
library(magrittr)
sddf_data %<>%
filter(!is.na(indo))
sddf_data %<>%
filter(!is.na(.$indo))
sddf_data %>%
filter(!is.na(.$indo))
tail(sddf_data[which(is.na(sddf_data$idno)),])
sddf_data %>%
filter(.,!is.na(.$indo))
sddf_data %>%
filter(.,!is.na(indo))
sddf_data %>%
filter(.,!is.na(.$indo))
sddf_data %>%
filter(!is.na(idno))
sddf_data %<>%
filter(!is.na(idno))
for(i in 1:length(svyinfo)){
x <- svyinfo[[i]]
country <- as.character(x$country)
#skip Austria
if (country %in% c("Austria","Albania")) {
next
} else{
print(country)
source("download_sddf.R")
if(country == "Denmark"){
sddf_data %<>%
filter(!is.na(idno))
}
str <-
if (x$stratex1 == "yes") {
~ stratify
} else{
NULL
}
sta <-
if (x$stages > 1) {
~ psu + idno
} else{
~ idno
}
svydesign(
id = sta,
strata = str,
weights = 1 / sddf_data$prob,
data = sddf_data
)
}
}
sddf_data
sddf_data$stratify
is.na(sddf_data$stratify)
sum(is.na(sddf_data$stratify))
sum(sddf_data$stratify=="NA")
table(sddf_data$psu)
table(sddf_data$idno)
any(table(sddf_data$psu)>1)
which(table(sddf_data$psu)>1)
table(sddf_data$psu,sddf_data$stratify)
for(i in 1:length(svyinfo)){
x <- svyinfo[[i]]
country <- as.character(x$country)
#skip Austria
if (country %in% c("Austria","Albania")) {
next
} else{
print(country)
source("download_sddf.R")
if(country == "Denmark"){
sddf_data %<>%
filter(!is.na(idno))
}
if(country == "Iceland"){
#no stratification information in sddf
x$stratex1 <- "no"
}
str <-
if (x$stratex1 == "yes") {
~ stratify
} else{
NULL
}
sta <-
if (x$stages > 1) {
~ psu + idno
} else{
~ idno
}
svydesign(
id = sta,
strata = str,
weights = 1 / sddf_data$prob,
data = sddf_data
)
}
}
source("download_sddf.R")
i
for(i in 15:length(svyinfo)){
x <- svyinfo[[i]]
country <- as.character(x$country)
#skip Austria
if (country %in% c("Austria","Albania","Israel")) {
#Israel doesn't have weight data for round 6
next
} else{
print(country)
source("download_sddf.R")
if(country == "Denmark"){
sddf_data %<>%
filter(!is.na(idno))
}
if(country == "Iceland"){
#no stratification information in sddf
x$stratex1 <- "no"
}
str <-
if (x$stratex1 == "yes") {
~ stratify
} else{
NULL
}
sta <-
if (x$stages > 1) {
~ psu + idno
} else{
~ idno
}
svydesign(
id = sta,
strata = str,
weights = 1 / sddf_data$prob,
data = sddf_data
)
}
}
ess6_svydesign <-
sapply(svyinfo, function(x) {
# for(i in 1:length(svyinfo)){
#    x <- svyinfo[[i]]
country <- as.character(x$country)
#skip Austria
if (country %in% c("Austria","Albania","Israel")) {
#Israel doesn't have weight data for round 6
return(NULL)#next
} else{
print(country)
source("download_sddf.R")
if(country == "Denmark"){
sddf_data %<>%
filter(!is.na(idno))
}
if(country == "Iceland"){
#no stratification information in sddf
x$stratex1 <- "no"
}
str <-
if (x$stratex1 == "yes") {
~ stratify
} else{
NULL
}
sta <-
if (x$stages > 1) {
~ psu + idno
} else{
~ idno
}
svydesign(
id = sta,
strata = str,
weights = 1 / sddf_data$prob,
data = sddf_data
)
}
}
)
ess6_svydesign <-
sapply(svyinfo, function(x) {
# for(i in 1:length(svyinfo)){
#    x <- svyinfo[[i]]
country <- as.character(x$country)
#skip Austria
if (country %in% c("Austria","Israel")) {
#Israel doesn't have weight data for round 6
return(NULL)#next
} else{
print(country)
source("download_sddf.R")
if(country == "Denmark"){
sddf_data %<>%
filter(!is.na(idno))
}
if(country == "Iceland"){
#no stratification information in sddf
x$stratex1 <- "no"
}
str <-
if (x$stratex1 == "yes") {
~ stratify
} else{
NULL
}
sta <-
if (x$stages > 1) {
~ psu + idno
} else{
~ idno
}
svydesign(
id = sta,
strata = str,
weights = 1 / sddf_data$prob,
data = sddf_data
)
}
}
)
source('D:/Projects/sqp_ess_correction/download_sddf.R', echo=TRUE)
source('D:/Projects/sqp_ess_correction/download_sddf.R', echo=TRUE)
sddf_data <-
get.sddf(rounds = 6,country = "Albania",email="stefan.zins@gesis.org" )
sddf_data <-
get.sddf(rounds = 6,
country = "Austria",
email="stefan.zins@gesis.org")
library(magrittr)
# email   <- "stefan.zins@gesis.org"
# rounds  <- 6 # don't change this one yet!!
# country <- "Albania"
source("download_sddf.R")
#load sampling design information
read.csv2("svydesign_info_ESS6.csv") %>%
filter(domains %% 1 == 0) %>%
split(.,.$country) ->
svyinfo
ess6_svydesign <-
sapply(svyinfo, function(x) {
country <- as.character(x$country)
#skip Austria
if (country %in% c("Austria", "Israel")) {
#Austria: 'Error in dataset[[1]] : subscript out of bounds'
#Israel doesn't have weight data for round 6 in the SDDF
return(NULL)
} else {
print(country)
sddf_data <-
get.sddf(rounds = 6,
country = country,
email = "stefan.zins@gesis.org")
if (country == "Denmark") {
sddf_data %<>%
filter(!is.na(idno))
}
if (country == "Iceland") {
#no stratification information in sddf
x$stratex1 <- "no"
}
str <-
if (x$stratex1 == "yes") {
~ stratify
} else{
NULL
}
sta <-
if (x$stages > 1) {
~ psu + idno
} else{
~ idno
}
svydesign(
id = sta,
strata = str,
weights = 1 / sddf_data$prob,
data = sddf_data
)
}
})
#load sampling design information
read.csv2("svydesign_info_ESS6.csv") %>%
filter(domains %% 1 == 0) %>%
split(.,.$country) ->
svyinfo
mk_ess_svy  <- function(svyinfo,
rounds = 6,
email = "stefan.zins@gesis.org") {
country <- as.character(svyinfo$country)
#skip Austria
if (country %in% c("Austria", "Israel")) {
#Austria: 'Error in dataset[[1]] : subscript out of bounds'
#Israel doesn't have weight data for round 6 in the SDDF
return(NULL)
} else {
print(country)
sddf_data <-
get_sddf(rounds = rounds,
country = country,
email = email)
if (country == "Denmark") {
sddf_data %<>%
filter(!is.na(idno))
}
if (country == "Iceland") {
#no stratification information in sddf
svyinfo$stratex1 <- "no"
}
str <-
if (svyinfo$stratex1 == "yes") {
~ stratify
} else{
NULL
}
sta <-
if (svyinfo$stages > 1) {
~ psu + idno
} else{
~ idno
}
svydesign(
id = sta,
strata = str,
weights = 1 / sddf_data$prob,
data = sddf_data
)
}
}
ess6_svydesign <- sapply(svyinfo, mk_ess_svy)
# email   <- "stefan.zins@gesis.org"
# rounds  <- 6 # don't change this one yet!!
# country <- "Albania"
source("download_sddf.R")
ess6_svydesign <- sapply(svyinfo, mk_ess_svy)
# email   <- "stefan.zins@gesis.org"
# rounds  <- 6 # don't change this one yet!!
# country <- "Albania"
source("download_sddf.R")
ess6_svydesign <- sapply(svyinfo, mk_ess_svy)
